= Showcase for knative eventing based on camel and quarkus

This project holds a showcase knative eventing with camel and quarkus.

== Tools

brew install knative/client/kn

== Install Minikube

minikube start --driver=virtualbox --cpus=4
minikube addons enable metrics-server
minikube addons enable registry

== Install Knative

kubectl apply -f https://github.com/knative/operator/releases/download/v0.25.0/operator.yaml

```shell
kubectl apply -f - <<EOF
apiVersion: v1
kind: Namespace
metadata:
    name: knative-serving
---
apiVersion: operator.knative.dev/v1alpha1
kind: KnativeServing
metadata:
    name: knative-serving
    namespace: knative-serving
EOF
```

kubectl apply -f https://github.com/knative/serving/releases/download/v0.25.0/serving-default-domain.yaml

```shell
kubectl apply -f - <<EOF
apiVersion: v1
kind: Namespace
metadata:
    name: knative-eventing
---
apiVersion: operator.knative.dev/v1alpha1
kind: KnativeEventing
metadata:
    name: knative-eventing
    namespace: knative-eventing
EOF
```

== Install Kamel

```shell
brew install kamel
kamel install --olm=false
```

== Install Kafka

```shell
kubectl apply -f - <<EOF
apiVersion: v1
kind: Service
metadata:
  name: redpanda
spec:
  ports:
  - name: http
    port: 9092
    targetPort: 9092
  selector:
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/name: redpanda
  name: redpanda
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: redpanda
  template:
    metadata:
      labels:
        app.kubernetes.io/name: redpanda
    spec:
      containers:
      - env:
        image: vectorized/redpanda:latest
        imagePullPolicy: Always
        name: redpanda
        ports:
        - containerPort: 9092
          name: http
          protocol: TCP
EOF
```

kubectl apply -f https://github.com/knative-sandbox/eventing-kafka-broker/releases/download/v0.25.0/eventing-kafka-controller.yaml
kubectl apply -f https://github.com/knative-sandbox/eventing-kafka-broker/releases/download/v0.25.0/eventing-kafka-broker.yaml
kubectl apply -f https://storage.googleapis.com/knative-releases/eventing-contrib/latest/kafka-source.yaml

```shell
kubectl apply -f - <<EOF
apiVersion: eventing.knative.dev/v1
kind: Broker
metadata:
    annotations:
        eventing.knative.dev/broker.class: Kafka
    name: default
    namespace: default
spec:
    config:
        apiVersion: v1
        kind: ConfigMap
        name: kafka-broker-config
        namespace: knative-eventing
EOF
```

== Links

- https://piotrminkowski.com/2021/06/14/knative-eventing-with-quarkus-kafka-and-camel/
- https://github.com/csantanapr/knative-minikube
- https://knative.dev/docs/admin/install/knative-with-operators/

=== Kafka

- https://vectorized.io/docs/quick-start-kubernetes/
- https://github.com/piomin/sample-quarkus-serverless-kafka

=== Apache Camel

- https://camel.apache.org/docs/
- https://www.awstutorials.cloud/post/tutorials/camel-k-on-minikube/
- https://piotrminkowski.com/2020/12/08/apache-camel-k-and-quarkus-on-kubernetes/

